meta {
  name: col2_GETGoRestAuth
  type: http
  seq: 10
}

get {
  url: {{gorest_base_url}}{{gorest_users_path}}?page=1&per_page=3
  body: none
  auth: bearer
}

params:query {
  page: 1
  per_page: 3
}

headers {
  Authorization: Bearer {{gorest_token}}
  Accept: application/json
}

auth:bearer {
  token: {{gorest_token}}
}

script:pre-request {
  // Token gratuit exemple (valide en 2025 ‚Äì remplace par le tien sur gorest.co.in)
  const token = "e761243054d12fcec19fba6ad5120789909f08c13ece23acb7c6765189e387d4";  // Exemple des docs
  bru.setVar("gorest_token", token);
  
  console.log("Auth Bearer activ√© avec token");
  console.log(`Token utilis√© : ${token.substring(0, 10)}...`);  // Masqu√© pour s√©curit√©
}

script:post-response {
  if (res.status === 200) {
      const users = res.body;  // Auto-pars√© en array
      console.log(`‚úÖ ${users.length} users authentifi√©s r√©cup√©r√©s`);
     
      // Sauvegarde un email al√©atoire pour test futur
      if (users.length > 0) {
          const randomUser = users[Math.floor(Math.random() * users.length)];
          bru.setVar("test_user_email", randomUser.email);
          console.log(`‚Üí Email sauvegard√© pour test filtre : ${randomUser.email}`);
      }
  } else if (res.status === 401) {
      console.error("üîí Token invalide ou expir√© ! G√©n√®re un nouveau sur gorest.co.in/my-account/access-tokens");
  } else {
      console.error(`‚ùå √âchec requ√™te GO REST - Status: ${res.status}`);
  }
}

tests {
  test("Status 200 avec Auth", function () {
      expect(res.status).to.equal(200);
  });
  
  test("Array users avec auth (3 users)", function () {
      expect(res.body).to.be.an("array").and.to.have.lengthOf(3);
      res.body.forEach(user => {
          expect(user).to.have.property("id").that.is.a("number");
          expect(user.email).to.include("@");
          expect(user.name).to.be.a("string").and.not.empty;
      });
  });
  
  test("Header Authorization bien envoy√©", function () {
      const sentHeaders = req.getHeaders();
      const authHeader = sentHeaders["authorization"] || sentHeaders["Authorization"];
      expect(authHeader).to.include("Bearer ");
      expect(authHeader).to.include(bru.getVar("gorest_token").substring(0, 10));  // V√©rif partielle pour s√©curit√©
  });
  
  test("Header Accept bien envoy√©", function () {
      const sentHeaders = req.getHeaders();
      expect(sentHeaders["accept"] || sentHeaders["Accept"]).to.equal("application/json");
  });
  
  test("Temps de r√©ponse < 1000ms", function () {
      expect(res.responseTime).to.be.a("number").and.to.be.below(10000);
  });
}

settings {
  encodeUrl: true
  timeout: 0
}

docs {
  Parfait üî•
  Voici ton **2·µâ exercice niveau Beginner**, l√©g√®rement plus avanc√© mais **toujours simple et clair**.
  
  ---
  
  # üü© **üìò EXERCICE 2 ‚Äî Niveau Beginner**
  
  Voici la r√©ponse JSON retourn√©e par l‚ÄôAPI :
  
  ```json
  {
    "success": true,
    "user": {
      "id": 42,
      "name": "Bob Marley",
      "email": "bob@example.com"
    },
    "meta": {
      "request_id": "XYZ-999"
    }
  }
  ```
  
  Tu dois √©crire des tests pour v√©rifier :
  
  ---
  
  # ‚úîÔ∏è **üëâ 1. Le status code doit √™tre 201**
  
  ---
  
  # ‚úîÔ∏è **üëâ 2. Le body doit contenir la cl√© "user"**
  
  ---
  
  # ‚úîÔ∏è **üëâ 3. Le champ user.name doit √™tre exactement "Bob Marley"**
  
  ---
  
  # ‚úîÔ∏è **üëâ 4. Le champ user.email doit contenir le symbole "@"**
  
  (Indice : `.to.contain("@")`)
  
  ---
  
  # ‚úîÔ∏è **üëâ 5. Stocker la valeur de user.id dans une variable nomm√©e "userId"**
  
  (Indice : `bru.setVar("userId", ...)`)
  
  ---
  
  # ‚úîÔ∏è **üëâ 6. V√©rifier que meta.request_id existe**
  
  (Indice : `.to.have.property("request_id")`)
  
  ---
  
  # üìå **Tu dois √©crire les 6 r√©ponses sous forme de tests.**
  
  Quand tu as fini, je te donne la **correction compl√®te** + **explications**, comme pour l‚Äôexercice 1.
  
  üí™ √Ä toi !
  
  # ‚úîÔ∏è **üëâ 1. Le status code doit √™tre 201**
  test(" Le status code doit √™tre 201", ()=> {
    expect(res.status).to.equal(201)
  });
  
  # ‚úîÔ∏è **üëâ 2. Le body doit contenir la cl√© "user"**
  test("Le body doit contenir la cl√© user", ()=>{
    expect(res.body).to.have.property("user")
  });
  
  # ‚úîÔ∏è **üëâ 3. Le champ user.name doit √™tre exactement "Bob Marley"**
  
  test("Le champ user.name doit √™tre exactement Bob Marley", ()=>{
    expect(res.body.name).to.equal("Bob Marley")
  });
  
  # ‚úîÔ∏è **üëâ 4. Le champ user.email doit contenir le symbole "@"**
  
  (Indice : `.to.contain("@")`)
  
  test("Le champ user.email doit contenir le symbole @", ()=>{
    expect(res.body).to.contains("@")
  });
  
  # ‚úîÔ∏è **üëâ 5. Stocker la valeur de user.id dans une variable nomm√©e "userId"**
  
  (Indice : `bru.setVar("userId", ...)`)
  
  test("Stocker la valeur de user.id dans une variable nomm√©e userId", ()=>{
    let userId = bru.setVar("userId", user.id)
  });
  
  # ‚úîÔ∏è **üëâ 6. V√©rifier que meta.request_id existe**
  
  (Indice : `.to.have.property("request_id")`)
  
  test("V√©rifier que meta.request_id existe", ()=>{
    expect(res.body).to.have.property("request_id")
  });
  
  
  
  
  
  
  
  
  
  
  
  
  Parfait üî•
  Voici ton **Exercice Beginner 3**, un peu plus riche, mais toujours simple.
  Tu vas manipuler :
  
  * status code
  * headers
  * JSON imbriqu√©
  * existence de champs
  * valeurs exactes
  * stockage de donn√©es
  
  ---
  
  # üü© **üìò EXERCICE 3 ‚Äî Niveau Beginner**
  
  Voici la r√©ponse API re√ßue :
  
  ### üü¶ **Response Status : 200**
  
  ### üü¶ **Response Headers :**
  
  ```
  content-type: application/json
  x-request-id: abc-123-xyz
  server: nginx
  ```
  
  ### üü¶ **Response Body :**
  
  ```json
  {
    "product": {
      "id": 987,
      "name": "Laptop Ultra 15",
      "price": 1499.99,
      "specs": {
        "ram": "16GB",
        "storage": "512GB SSD"
      }
    },
    "available": true
  }
  ```
  
  ---
  
  ## üéØ **√âcris les 7 tests suivants :**
  
  ---
  
  # ‚úîÔ∏è **1. V√©rifier que le status est 200**
  test("status 200", ()=>{
    expect(res.status).to.equal(200)
  });
  
  ---
  
  # ‚úîÔ∏è **2. V√©rifier que le header content-type contient "json"**
  
  (indice : `res.headers["content-type"]`)
  test("type json", ()=>{
    expect(res.header["content-type"]).to.containt("application/json")
  });
  
  ---
  
  # ‚úîÔ∏è **3. V√©rifier que product.id existe**
  
  test("product id exist", ()=>{
    expect(res.body.product.id).to.have.property(product.id)
  });
  
  ---
  
  # ‚úîÔ∏è **4. V√©rifier que product.name = "Laptop Ultra 15"**
  
  test("product name exist", ()=>{
    expect(res.body.product.name).to.equal("Laptop Ultra 15")
  });
  ---
  
  # ‚úîÔ∏è **5. V√©rifier que specs.ram = "16GB"**
  
  (indice : `res.body.product.specs.ram`)
  test("space name = 16GB", ()=>{
    expect(res.body.product.space.ram).to.equal("16GB")
  });
  ---
  
  # ‚úîÔ∏è **6. V√©rifier que available est true**
  test("availabel is true", ()=>{
    expect(res.body.available).to.bootean(true)
  });
  ---
  
  # ‚úîÔ∏è **7. Stocker product.price dans une variable Bruno appel√©e "price"**
  
  (indice : `bru.setVar("price", ...)`)
  test("stokck product", ()=>{
    let price = bru.getVar("price", bru.product.price)
  });
  ---
  
  # üìå **Tu dois r√©pondre en √©crivant les 7 tests.**
  
  Quand tu as fini, je te corrige comme d‚Äôhabitude (avec explications).
  
}
