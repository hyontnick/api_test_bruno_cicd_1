meta {
  name: GetGit
  type: http
  seq: 11
}

get {
  url: {{github_url}}user?dummy=test
  body: none
  auth: bearer
}

params:query {
  dummy: test
}

headers {
  Accept: application/vnd.github+json
  ~Authorization: token {{github_token}}
}

auth:bearer {
  token: {{github_token}}
}

vars:pre-request {
  note_message: "Test GitHub"
}

assert {
  res.status: eq 200
  res.responseTime: lt 10000
  res.body.login: eq "hyontnick"
  res.body.html_url: contains "hyontnick"
}

script:pre-request {
  // VÃ©rifie si le token existe
  const token = bru.getVar("github_tokenk");
  
  if (!token) {
    console.error("âŒ Aucun token GitHub trouvÃ© !");
  } else {
    console.log("ğŸ”‘ Token dÃ©tectÃ©.");
    console.log("Test variable note:", bru.getVar("note_message"));
  }
  
  // Ajouter une variable dynamique
  bru.setVar("request_timestamp", new Date().toISOString());
  
}

script:post-response {
  if (res.status === 200) {
      console.log("âœ… Authentification rÃ©ussie !");
      console.log(`Nom : ${res.body.name}`);
      console.log(`Login : ${res.body.login}`);
  
      // Sauvegarde du login dans une variable
      bru.setVar("last_user_login", res.body.login);
  } else {
      console.error(`âŒ Ã‰chec : Status ${res.status}`);
  }
  
}

tests {
  test("Status must be 200", () => {
    expect(res.status).to.equal(200);
  });
  
  test("Response contains an id greater than 0", () => {
    expect(res.body.id).to.be.greaterThan(0);
  });
  
}

settings {
  encodeUrl: true
  timeout: 0
}

docs {
  RÃ©cupÃ¨re les informations de lâ€™utilisateur connectÃ© via GitHub API.
  Cette requÃªte permet de dÃ©montrer lâ€™utilisation des headers, variables,
  scripts pre-request et post-request dans Bruno.
  
  - Headers : Authorization Bearer token
  - Vars : last_user_login
  - Pre-request : vÃ©rification du token
  - Post-request : sauvegarde login
  - Assert/Test : vÃ©rifier que le status est 200 et login existe
  
}